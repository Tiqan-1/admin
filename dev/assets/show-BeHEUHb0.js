import{u as A,F as i,d as w,a as F,b as m,e as N,j as s,f as B,S as u,T as C,D as L,R as P,C as g,c as $,I as x,g as k,B as G,h as D,i as E}from"./index-A-adSsHM.js";import{r as h}from"./assignment-responses-B4852wux.js";import{C as t}from"./index-CNmwCIuf.js";import{T as K}from"./index-D56weOLy.js";const{Title:M,Text:a,Paragraph:j}=C;function J(){const{t:n}=A(),[y]=i.useForm(),b=w(),{responseId:o}=F(),{data:r,isLoading:v}=m({queryKey:["assignment-response",o],queryFn:()=>h.show(o),enabled:!!o}),d=r==null?void 0:r.assignmentId,{data:c,isLoading:R}=m({queryKey:["assignment-details",d],queryFn:()=>E.show(d),enabled:!!d}),p=N({mutationFn:e=>h.grade(o,e),onSuccess:()=>{D.success(n("app.assignmentResponses.grade-saved-successfully")),b(`/assignments/${d}/responses`)},onError:e=>{}}),S=e=>{const{notes:l,...T}=e;p.mutate({scores:T,notes:l})};if(v||R)return s.jsx(t,{children:s.jsx(B,{active:!0})});if(!r||!c)return s.jsx(t,{children:n("common.no-data")});const I=c.form.slides.flatMap(e=>e.elements).filter(e=>e.question);return s.jsxs(u,{direction:"vertical",size:"large",className:"w-full",children:[s.jsxs(t,{children:[s.jsxs(M,{level:4,children:[n("app.assignmentResponses.grading-submission-for")," ",r.student.name]}),s.jsx(a,{type:"secondary",children:c.title})]}),s.jsxs(i,{form:y,onFinish:S,layout:"vertical",children:[I.map((e,l)=>s.jsxs(t,{title:`${n("app.fields.question")} ${l+1}`,style:{marginBottom:16},children:[s.jsx(j,{strong:!0,children:e.question}),r.individualScores[e.id]!==e.score&&e.answer&&s.jsxs("div",{style:{width:"fit-content",background:"#f6ffed",border:"1px solid #b7eb8f",padding:"8px",borderRadius:"4px",marginBottom:"12px"},children:[s.jsxs(a,{strong:!0,type:"success",children:[n("app.assignmentResponses.correct-answer"),": "]}),s.jsx(a,{type:"success",children:f(e.answer)})]}),s.jsx(L,{style:{margin:"12px 0"}}),s.jsxs(P,{gutter:16,align:"middle",children:[s.jsxs(g,{span:12,children:[s.jsxs(a,{strong:!0,children:[n("app.assignmentResponses.student-answer"),":"]}),s.jsx(j,{className:r.individualScores[e.id]>0?"":"line-through",children:f(r.replies[e.id])||s.jsx(a,{type:"secondary",children:"No answer"})})]}),s.jsx(g,{span:12,children:Q(e.type)?s.jsxs(u,{direction:"vertical",children:[s.jsxs(a,{strong:!0,children:[n("app.assignmentResponses.auto-grade"),":"]}),s.jsxs($,{color:r.individualScores[e.id]>0?"green":"red",icon:r.individualScores[e.id]>0?s.jsx(x,{icon:"solar:check-circle-bold"}):s.jsx(x,{icon:"solar:close-circle-bold"}),children:[r.individualScores[e.id]||0," / ",e.score]})]}):s.jsx(i.Item,{label:s.jsxs(a,{strong:!0,children:[n("app.assignmentResponses.enter-score"),":"]}),name:e.id,initialValue:r.individualScores[e.id]||0,rules:[{type:"number",min:0,max:e.score,message:n("app.assignmentResponses.score-out-of-range",{max:e.score})}],children:s.jsx(K,{min:0,max:e.score,addonAfter:`/ ${e.score}`})})})]})]},e.id)),s.jsxs(t,{title:n("app.assignmentResponses.final-notes-and-submission"),children:[s.jsx(i.Item,{label:n("app.fields.notes"),name:"notes",initialValue:r.notes,children:s.jsx(k.TextArea,{rows:4})}),s.jsx(i.Item,{children:s.jsx(G,{type:"primary",htmlType:"submit",loading:p.isPending,children:n("app.assignmentResponses.save-final-grade")})})]})]})]})}function Q(n){return["choice","select","number","true-false"].includes(n)}function f(n){return n==null?"-":Array.isArray(n)?n.join(", "):String(n)}export{J as default};
